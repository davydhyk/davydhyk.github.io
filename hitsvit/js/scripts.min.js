$(function() {

  $('body').click(function (e) {
    var container = $('.night-cnt');
    if ($(e.target).is('.input-wrap .nights .nice-select')) return 0;
    if (container.has(e.target).length == 0 && container.hasClass('active')){
      $('.input-wrap .nights .nice-select').trigger('click');
    }
  });

  $('.input .date input[type="text"]').on('change', function () {
    $('.night-res span b:first-child').text($(this).val());
  });

  setTimeout(function () {$('.input .date input[type="text"]').trigger('change');}, 1000);

  $('.input .date input[type="checkbox"]').on('change', function () {
    if ($(this).prop('checked')) $('.pm').show();
    else $('.pm').hide();
  });

  $('.night-input .fa-minus').click(function () {
    var inp = $(this).next();
    inp.val((parseInt(inp.val()) - 1 > 0) ? parseInt(inp.val()) - 1 : 1);
    var to = $(this).parent().parent().find('.to input');
    var from = $(this).parent().parent().find('.from input');
    to.val((parseInt(from.val()) > parseInt(to.val())) ? parseInt(from.val()) : parseInt(to.val()));
    
    if (to.val() - from.val() > 7 )
  		to.val(parseInt(from.val())+7)
    
    $('.night-res span b:last-child').text(from.val() + ' - ' + to.val());
    $('.nights .current').text(from.val() + '-' + to.val());
    $('#night_from-to').val(from.val() + '-' + to.val());
    
  });

  $('.night-input .fa-plus').click(function () {
    var inp = $(this).prev();
    inp.val(parseInt(inp.val()) + 1);
    var to = $(this).parent().parent().find('.to input');
    var from = $(this).parent().parent().find('.from input');
    from.val((parseInt(from.val()) > parseInt(to.val())) ? parseInt(to.val()) : parseInt(from.val()));
    
  	
  	if (to.val() - from.val() > 7 )
  		to.val(parseInt(from.val())+7)
  	
  	$('.night-res span b:last-child').text(from.val() + ' - ' + to.val());
  	
  	$('.nights .current').text(from.val() + ' - ' + to.val());
  	 $('#night_from-to').val(from.val() + '-' + to.val());
  
  	
  });

  $('.input-wrap .nights .nice-select').click(function () {
    $(this).parent().parent().toggleClass('open');
    $(this).toggleClass('active').toggleClass('open').parent().next().toggleClass('active');
  });
	
	$.expr[":"].contains = $.expr.createPseudo(function(arg) {
        return function(elem) {
            return $(elem).text().toUpperCase().indexOf(arg.toUpperCase()) >= 0;
        };
    });
	
	 $('.search-hotel').on('input', function() {
        var val = $(this).val();
        
        $('.hotel-list .city-check .city-name ' ).parent().hide();
        $('.hotel-list .city-check .city-name:contains("' + val + '")' ).each(function() {
      
                $(this).parent().show();
             
        }) 
    })
    
    
	
	 $('[name="tel"]').mask('(000) 000-0000');
	
	var count
	
	$('#wpcf7-f1211-o1 .radio-499 label').each(function () {
		var span = $(this).find('span');
		$(this).find('span').remove();
		$(this).find('input').after(span);
	});
	
	
	$('#itt_hotel_rating_block input').change(function(e){
		count = $('#itt_hotel_rating_block input:checked').length
		if (count > 2) {
			
			var prev = $(this).parent().prevAll('li').find(':checked').length 
			var next = $(this).parent().nextAll('li').find(':checked').length 
			 
			if (prev == 2) 
				$('#itt_hotel_rating_block  input:checked').first().prop('checked', false) 
			else
				$('#itt_hotel_rating_block  input:checked').last().prop('checked', false) 
			return;
		}
		
		 
		
		get_hotels(); 
		
	})

 $('.fancybox').fancybox()
	// Custom JS
  $('.menu-btn').on('click', function(e) {
    e.preventDefault;
    $(this).toggleClass('menu-btn_active');
    $('.menu-resp ul').toggleClass('open');
    if ($('.menu-resp ul').hasClass('open')) {
      if (screen.width <= '577') {
        $('.menu-resp ul').width(screen.width - 40);
        $('.menu-resp ul').css('right', -15);
      }
      $('.menu-resp ul').slideDown();
    } else {
      $('.menu-resp ul').slideUp();
    }
  });
  
  $('.tabs').tabulous();
  
  $('.input select').niceSelect();
  
   
  
  $('.extended-search select').niceSelect();
  
  if ($('*').is('script[src*="jquery-ui"]')) {
    $( ".slider-range" ).slider({
      range: true,
      min: 0,
      max: 200000,
      values: [ 1000, 150000 ],
      slide: function( event, ui ) {
        $( 'input[name="price_from"]' ).val( ui.values[0] );
        $( 'input[name="price_till"]' ).val( ui.values[1] );
        $('.val-price-from').html( ui.values[0] );
        $('.val-price-till').html( ui.values[1] );
      }
    });
  }
  
  $('.arrow, .other-country').click(function () {
 
	$('.popular, .alpha').removeClass('hide');
	$('.current-param, .select-city.tab-hide, .select-hotel.tab-hide, .select-wrap').addClass('hide');

 });
  
  
	$('a.pop-a').click(function (e) {
		e.preventDefault();
		var that = $(this)
		var city = $(this).html();
		var term_slug = $(this).attr('data-term_slug')
		$('.country_id').val(term_slug);
		$('.param-cities').html('<li><span class="param-item">Все города</span></li>');
		 
		$('  .city').html(city);
 
		 
		$('.country-placeholder').val(city);
		$('.param-country .param-item').html(city);
		
		
		$('.popular, .alpha').addClass('hide');
		$('.current-param, .select-city.tab-hide, .select-hotel.tab-hide, .select-wrap').removeClass('hide');
	
		 $.ajax({ 
             url: globals.url,
             data: {
             	action : 'get_regions',
             	term_id: that.attr('data-term_id')
             },
             success: function(data) {             	 
               	
		      $('.city-list').html(data);
		      $('.param-wrap').slimscroll({
			      height: 185,
			      color: '#145ce6',
			      allowPageScroll: true,
			      disableFadeOut: true
			    });        
			    
			    get_hotels();         
             }
         });
	
	
	});
  
  
  
  
  $(document).on('change', '.city-list input', function() {
  	$('.param-cities').html('');
  	$('.param-hotels').html('');
  	var count = 0; 
  	$('.city-list input:checked').each(function(){
  		var val = $(this).val();
  		var name = $(this).parent().find('.city-name').html()
  		$('.param-cities').append('<li><span class="param-item">'+name+'</span><span data-val="'+ val +'" class="param-close">×</span></li>');
  		count++;
  		
  	})
   
  	if (count == 0) { 
  		$('.param-cities').html('<li><span class="param-item">Все города</span></li>');  		
  	}
  	
  	get_hotels();
  	 
  	 
  	
  })
  
  function get_hotels() {
  	$.ajax({
         url: globals.url,
         data: $('.search-form').serialize() + '&hotels=1',
         success: function(data) {     
	         $('.hotel-list').html(data)            
         }
     });
  }
  
	$(document).on('click', '.btn-show-more-tours', function(e) {
  	 e.preventDefault();
  	 $(this).parent().remove()
  	 $('.result-list').animate({
         'opacity': 0.7
     }, 400)        
  	 $.ajax({
         url: globals.url,
         data: $('.search-form').serialize() + '&page=' + $(this).attr('href'),
         success: function(data) {     
	         $('.result-list').append(data)     ;
	         $('.result-list').animate({
		         'opacity': 1
		     }, 400)       
         }
     });
  })
  
  
  
  $(document).on('change', '.hotel-list input', function() {
  	$('.param-hotels').html('');
  	var count = 0; 
  	$('.hotel-list input:checked').each(function(){
  		var val = $(this).val();
  		var name = $(this).parent().find('.city-name').html()
  		$('.param-hotels').append('<li><span class="param-item">'+name+'</span><span data-val="'+ val +'" class="param-close">×</span></li>');
  		count++;
  		
  	})
   
  	if (count == 0) { 
  		$('.param-hotels').html('<li><span class="param-item">Все отели</span></li>');  		
  	}
  	
  	get_hotels();
  	 
  	 
  	
  })
  
  
  $(document).on('click', '.param-close', function() {
   	
  	 
  	var val = $(this).attr('data-val');
  	$('input[value="' + val +'"]').prop('checked', false);
  	$(this).closest('li').remove();
  	 
  })
  
  
  
  
  
   
    $(document).on('click','.input-block a',function (e) {
        e.preventDefault();
        var min = 1;
        var max = 4;
        var i  ;
        
        if ($(this).parent().hasClass('count-children'))
        	min = 0;
        	max = 3;
        	
        if ($(this).parent().hasClass('count-children-age')) {
		 	 min = 1;
		 	 max = 15;
		 }
        	
        var c=$(this).parent().find('input').val();
     
        if($(this).hasClass('plus-people')){
			c++;
			if( c > max)  
			c = 4;
			$(this).parent().find('input').val(c);
        }
        else{
            if(c>min) {
                c--;
                $(this).parent().find('input').val(c);
            }
        }
        
         if ($(this).parent().hasClass('count-children') && !$(this).parent().hasClass('count-children-age')) {
		 	 $('.count-children-age').hide();
		 	 for (i=1;i<=c;i++)
		 	 	$('.count-children-age-' + i).css({'display': 'flex'});
		 }
        
        
        $(this).parent().find('.value-num').text(c)
      
         

    })
  
  
   $('input[name="hotel_rating"]').change(function() {
   	$('.val-stars').html($('input[name="hotel_rating"]:checked').attr('data-name'))
   })
   
  $(document).on('click', '.img-thumb', function() {
  	var full = $(this).attr('data-full');
  	$('.hotel-img img').attr('src', full);
   })
   
    $(document).on('click', '.show_more_offers', function() {
  	$(this).closest('.result-item').find('.more_tours').slideToggle();
   })
   
   
  
  
  
  $('.slider').slick({
    prevArrow: $('.control-left span'),
    nextArrow: $('.control-right span'),
    slidesToShow: 2,
    responsive: [
    {
      breakpoint: 769,
      settings: {
        slidesToShow: 1,
      }
    }]
  });
  
  $('.extend').click(function () {
    $(this).parent().parent().next().slideToggle();
    $('.filter-overlay').fadeToggle();
	if (!$('.goal').hasClass('hide')) $('.goal .close span').trigger('click');
  });
	
  $('.extended-search').click(function () {
	  if (!$('.goal').hasClass('hide')) $('.goal .close span').trigger('click');
  });
  
  function closeSearch () {
    $('.filter-overlay').fadeOut();
    $('.extended-search').slideUp();
  }
  
 // $('.tabs ul li a:not(.pop-a)').click(function () {closeSearch();});
  $('.filter-overlay').click(function () {closeSearch();});
  
  $('.filter-block input[type="submit"]').click(function (e) {
     
    closeSearch();
    $('.result-overlay').fadeIn();
    $('body').css('overflow', 'hidden');
  });
  
  $('.result .close span').click(function () {
    $('body').css('overflow', 'auto');
    $('.result-overlay').fadeOut();
  });
  
  $('.result .back a').click(function (e) {
    e.preventDefault();
    $('body').css('overflow', 'auto');
    $('.result-overlay').fadeOut();
  });
  
  if ($('*').is('script[src*="slim"]')) {
    $('.param-wrap').slimscroll({
      height: 185,
      color: '#145ce6',
      allowPageScroll: true,
      disableFadeOut: true
    });

    $('.select-city:not(.resp) .select-city-wrap, .select-hotel:not(.resp) .select-hotel-wrap, .alpha-wrap').slimscroll({
      height: 270,
      color: '#145ce6',
      allowPageScroll: true,
      disableFadeOut: true
    });
    
    $('.select-city.resp .select-city-wrap, .select-hotel.resp .select-hotel-wrap').slimscroll({
      height: 235,
      color: '#145ce6',
      allowPageScroll: true,
      disableFadeOut: true
    });
  }
  
  $('.switch .title > span.hotels').click(function () {
    $(this).parent().children('span.cities').removeClass('active');
    $(this).parent().parent().parent().children('.select-city.resp').addClass('hide').removeClass('tab-show');
    $(this).parent().parent().parent().children('.select-hotel.resp').removeClass('hide').addClass('tab-show');
    $(this).addClass('active');
  });
  
  $('.switch .title > span.cities').click(function () {
    $(this).parent().children('span.hotels').removeClass('active');
    $(this).parent().parent().parent().children('.select-city.resp').removeClass('hide').addClass('tab-show');
    $(this).parent().parent().parent().children('.select-hotel.resp').addClass('hide').removeClass('tab-show');
    $(this).addClass('active');
  });
  
  /*$('.other-country span').click(function () {
    var elem = $(this).parent().parent().parent();
    elem.children('.popular, .alpha').removeClass('hide');
    elem.children('.current-param, .select-city.tab-hide, .select-hotel.tab-hide, .select-wrap').addClass('hide');
  });*/
  

  
  $('.input-wrap span.arrow').click(function () {
    var goal = $(this);
    while (!goal.is('.input-wrap')) goal = goal.parent();
    goal = goal.next();
    goal.toggleClass('hide');
  });
  
  $('.goal .close span').click(function () {
    var goal = $(this);
    while (!goal.is('.goal')) goal = goal.parent();
    goal.toggleClass('hide');
  });
});
